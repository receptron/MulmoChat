# LLM Native OS ãƒ“ã‚¸ãƒ§ãƒ³

MulmoChat ã‚’ã€ŒOSã€ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ã€ŒLLM Native Applicationã€ã¨ã—ã¦æ‰ãˆãŸè¨­è¨ˆãƒ“ã‚¸ãƒ§ãƒ³ã¨é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã€‚

> **æ³¨**: ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ [GUI Chat Protocol](../GUI_CHAT_PROTOCOL.md) ã‚’åŸºç›¤ã¨ã—ã¦ã€ãã®ç™ºå±•å½¢ã‚’è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚GUI Chat Protocol ã§å®šç¾©ã•ã‚ŒãŸã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆï¼ˆEnhanced Tool Callsã€Typed Return Dataã€Rolesã€Chat-Centric OSï¼‰ã®ä¸Šã«ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå¾‹å®Ÿè¡Œã€MCP çµ±åˆã€ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ãªã©ã®æ–°æ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹æ–¹å‘æ€§ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

## ç›®æ¬¡

1. [ã‚³ãƒ³ã‚»ãƒ—ãƒˆ](#ã‚³ãƒ³ã‚»ãƒ—ãƒˆ)
2. [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤)
3. [ç¾çŠ¶ã®æ©Ÿèƒ½](#ç¾çŠ¶ã®æ©Ÿèƒ½)
4. [ä¸è¶³ã—ã¦ã„ã‚‹æ©Ÿèƒ½](#ä¸è¶³ã—ã¦ã„ã‚‹æ©Ÿèƒ½)
5. [é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—](#é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—)
6. [è¨­è¨ˆåŸå‰‡](#è¨­è¨ˆåŸå‰‡)
7. [ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£](#ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£)

---

## ã‚³ãƒ³ã‚»ãƒ—ãƒˆ

### LLM Native OS ã¨ã¯

å¾“æ¥ã® OS ãŒãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚’æŠ½è±¡åŒ–ã—ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã« API ã‚’æä¾›ã™ã‚‹ã‚ˆã†ã«ã€LLM Native OS ã¯ LLM ã‚’æŠ½è±¡åŒ–ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼‰ã«çµ±ä¸€çš„ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›ã™ã‚‹ã€‚

```
å¾“æ¥ã® OS                          LLM Native OS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³                    ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆLLM Native Appï¼‰
    â†“                                  â†“
ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ¼ãƒ«                      context.app API
    â†“                                  â†“
ã‚«ãƒ¼ãƒãƒ«                           LLM Native OS Core
    â†“                                  â†“
ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢                        LLM / ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹
```

### ãªãœã“ã®è¦–ç‚¹ãŒé‡è¦ã‹

1. **ä¸è¶³æ©Ÿèƒ½ã®ç™ºè¦‹**: å¾“æ¥ OS ã®æ©Ÿèƒ½ã¨æ¯”è¼ƒã™ã‚‹ã“ã¨ã§ã€å¿…è¦ãªæ©Ÿèƒ½ãŒæ˜ç¢ºã«ãªã‚‹
2. **è¨­è¨ˆã®æŒ‡é‡**: å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è²¬å‹™ãŒæ˜ç¢ºã«ãªã‚Šã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆãŒæ”¹å–„ã•ã‚Œã‚‹
3. **ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ å½¢æˆ**: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºè€…ãŒå¢—ãˆã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒå……å®Ÿã™ã‚‹
4. **ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£**: OS å±¤ã‚’æŠ½è±¡åŒ–ã™ã‚Œã°ã€ç•°ãªã‚‹ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªã§ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å…±æœ‰ã§ãã‚‹

---

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å±¤

### 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤                         â”‚
â”‚              ï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ / LLM Native Appsï¼‰                 â”‚
â”‚                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚ Weather â”‚  â”‚ Othello â”‚  â”‚  Map    â”‚  â”‚  HTML   â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      OS å±¤ï¼ˆCoreï¼‰                           â”‚
â”‚                   gui-chat-protocol                         â”‚
â”‚                                                             â”‚
â”‚  ãƒ»å‹å®šç¾©ï¼ˆToolPlugin, ToolResult, ToolContextï¼‰             â”‚
â”‚  ãƒ»ãƒ—ãƒ­ãƒˆã‚³ãƒ«ï¼ˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ â†” OS é–“ã®å¥‘ç´„ï¼‰                      â”‚
â”‚  ãƒ»ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ï¼ˆå°†æ¥ï¼‰                                       â”‚
â”‚  ãƒ»ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ï¼ˆå°†æ¥ï¼‰                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå±¤                            â”‚
â”‚              ï¼ˆMulmoChat, å°†æ¥ã®ä»–ã‚¢ãƒ—ãƒªï¼‰                    â”‚
â”‚                                                             â”‚
â”‚  ãƒ»UI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å®Ÿè£…ï¼ˆVue/Reactï¼‰                         â”‚
â”‚  ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†                                            â”‚
â”‚  ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š                                              â”‚
â”‚  ãƒ»context.app ã®å®Ÿè£…                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å±¤                             â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ textLLM â”‚  â”‚imageGen â”‚  â”‚ search  â”‚  â”‚   map   â”‚      â”‚
â”‚  â”‚(Claude) â”‚  â”‚(Gemini) â”‚  â”‚  (Exa)  â”‚  â”‚(Google) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å„å±¤ã®è²¬å‹™

| å±¤ | è²¬å‹™ | å®Ÿè£…å ´æ‰€ |
|----|------|----------|
| **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤** | ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æ©Ÿèƒ½ã®æä¾› | å„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ |
| **OS å±¤** | æ¨™æº–ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®šç¾©ã€å±¤é–“ã®å¥‘ç´„ | gui-chat-protocol |
| **ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå±¤** | UI å®Ÿè£…ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€API æä¾› | MulmoChat |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å±¤** | å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®é€šä¿¡ | ã‚µãƒ¼ãƒãƒ¼ / API |

---

## ç¾çŠ¶ã®æ©Ÿèƒ½

### å®Ÿè£…æ¸ˆã¿ âœ…

| æ©Ÿèƒ½ | èª¬æ˜ | å®Ÿè£… |
|------|------|------|
| **ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ** | LLM ãŒãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å‘¼ã³å‡ºã— | execute() |
| **UI è¡¨ç¤º** | çµæœã®è¡¨ç¤ºï¼ˆView/Previewï¼‰ | Vue ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰æŠ½è±¡åŒ–** | ãƒ—ãƒ­ãƒã‚¤ãƒ€éä¾å­˜ | backends å®£è¨€ |
| **å¤–éƒ¨å…¥åŠ›** | ãƒ•ã‚¡ã‚¤ãƒ«/ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ | inputHandlers |
| **è¨­å®šç®¡ç†** | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®šã®ä¿å­˜ | getConfig/setConfig |
| **è¨­å®š UI ç§»è­²** | ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š UI ã‚’ã‚¢ãƒ—ãƒªã«å§”è­² | ToolPluginConfig |
| **LLM ã¸ã®æŒ‡ç¤º** | ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œå¾Œã®æŒ‡ç¤º | instructions |
| **çŠ¶æ…‹æ›´æ–°** | æ—¢å­˜çµæœã®æ›´æ–° | updating ãƒ•ãƒ©ã‚° |

---

## ä¸è¶³ã—ã¦ã„ã‚‹æ©Ÿèƒ½

### å„ªå…ˆåº¦: é«˜ ğŸ”´

#### 1. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå¾‹å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ï¼ˆAgentic Executionï¼‰

**ç¾çŠ¶ã®å•é¡Œ:**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å•ã„ã‹ã‘ â†’ è¿”ç­”ã®å˜ç´”ãªç¹°ã‚Šè¿”ã—ã®ã¿
- è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•ã§å®Œäº†ã§ããªã„
- ã‚¨ãƒ©ãƒ¼æ™‚ã«è‡ªå‹•ã§ä¿®æ­£ãƒ»ãƒªãƒˆãƒ©ã‚¤ã§ããªã„
- è¤‡æ•°ã®ä¾é ¼ã‚’ä¸¦è¡Œç®¡ç†ã§ããªã„

**å¿…è¦ãªæ©Ÿèƒ½:**

##### 1.1 è‡ªå‹•ãƒ«ãƒ¼ãƒ—å®Ÿè¡Œï¼ˆattempt_completion ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

```typescript
interface TaskExecution {
  // ã‚¿ã‚¹ã‚¯å®Œäº†åˆ¤å®š
  attemptCompletion: () => CompletionResult;

  // ç¶™ç¶šå®Ÿè¡Œ
  continueExecution: () => Promise<void>;

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªãŒå¿…è¦ãªå ´åˆ
  requestUserConfirmation: (question: string) => Promise<boolean>;
}

type CompletionResult =
  | { status: "completed"; summary: string }
  | { status: "needs_more_work"; nextAction: string }
  | { status: "needs_user_input"; question: string }
  | { status: "error"; error: string; canRetry: boolean };
```

##### 1.2 ã‚¿ã‚¹ã‚¯ãƒ»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†

```typescript
interface TaskContext {
  id: string;

  // ã‚¿ã‚¹ã‚¯ã®ç›®çš„ãƒ»æ„å›³
  purpose: {
    original: string;        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…ƒã®ä¾é ¼
    clarified: string;       // æ˜ç¢ºåŒ–ã•ã‚ŒãŸç›®çš„
    confirmedByUser: boolean;
  };

  // çŠ¶æ…‹ç®¡ç†
  state: TaskState;

  // Todo ãƒªã‚¹ãƒˆ
  todos: TodoItem[];

  // å®Ÿè¡Œå±¥æ­´
  history: ExecutionRecord[];

  // é–¢é€£ãƒªã‚½ãƒ¼ã‚¹
  resources: ResourceReference[];

  // ã‚¨ãƒ©ãƒ¼å±¥æ­´ã¨å­¦ç¿’
  errors: ErrorRecord[];
}

type TaskState =
  | "planning"      // è¨ˆç”»ä¸­
  | "executing"     // å®Ÿè¡Œä¸­
  | "waiting_user"  // ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å¾…ã¡
  | "error"         // ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
  | "completed";    // å®Œäº†

interface TodoItem {
  id: string;
  description: string;
  status: "pending" | "in_progress" | "completed" | "failed";
  result?: unknown;
}

interface ExecutionRecord {
  timestamp: Date;
  action: string;
  toolUsed?: string;
  input?: unknown;
  output?: unknown;
  success: boolean;
}
```

##### 1.3 ã‚¨ãƒ©ãƒ¼è‡ªå‹•è£œæ­£

```typescript
interface ErrorHandler {
  // ã‚¨ãƒ©ãƒ¼åˆ†æ
  analyzeError: (error: Error, context: TaskContext) => ErrorAnalysis;

  // è‡ªå‹•ä¿®æ­£ã®è©¦è¡Œ
  attemptAutoFix: (analysis: ErrorAnalysis) => Promise<FixResult>;

  // ãƒªãƒˆãƒ©ã‚¤æˆ¦ç•¥
  getRetryStrategy: (error: Error) => RetryStrategy;
}

interface ErrorAnalysis {
  type: "input_error" | "api_error" | "logic_error" | "resource_missing";
  cause: string;
  suggestedFix: string;
  canAutoFix: boolean;
}

interface RetryStrategy {
  shouldRetry: boolean;
  maxAttempts: number;
  backoffMs: number;
  modifyInput?: (original: unknown) => unknown;
}
```

##### 1.4 ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ç®¡ç†

```typescript
interface TaskManager {
  // ã‚¿ã‚¹ã‚¯ä½œæˆ
  createTask: (userRequest: string) => TaskContext;

  // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ã‚¹ã‚¯ä¸€è¦§
  getActiveTasks: () => TaskContext[];

  // ã‚¿ã‚¹ã‚¯åˆ‡ã‚Šæ›¿ãˆ
  switchTask: (taskId: string) => void;

  // ã‚¿ã‚¹ã‚¯ç›®çš„ã®ä¿®æ­£
  updatePurpose: (taskId: string, newPurpose: string) => void;

  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ç›®çš„ç¢ºèª
  confirmPurposeWithUser: (taskId: string) => Promise<boolean>;
}
```

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å…·ä½“ä¾‹:**

##### ä¾‹1: è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•å®Ÿè¡Œ

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’æ›¸ã„ã¦ã€ç”»åƒã‚‚ç”Ÿæˆã—ã¦ã€HTMLã«ã¾ã¨ã‚ã¦ã€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TaskContext ä½œæˆ                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id: "task-001"                                                  â”‚
â”‚ purpose:                                                        â”‚
â”‚   original: "ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’æ›¸ã„ã¦ã€ç”»åƒã‚‚ç”Ÿæˆã—ã¦ã€HTMLã«ã¾ã¨ã‚ã¦"   â”‚
â”‚   clarified: "AIæŠ€è¡“ã«é–¢ã™ã‚‹ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ä½œæˆã—ã€                 â”‚
â”‚              é–¢é€£ç”»åƒã‚’3æšç”Ÿæˆã—ã€HTMLãƒšãƒ¼ã‚¸ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹"        â”‚
â”‚   confirmedByUser: false  â† å¿…è¦ã«å¿œã˜ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèª           â”‚
â”‚                                                                 â”‚
â”‚ state: "planning"                                               â”‚
â”‚                                                                 â”‚
â”‚ todos:                                                          â”‚
â”‚   [1] ãƒ–ãƒ­ã‚°è¨˜äº‹ã®åŸ·ç­† (pending)                                 â”‚
â”‚   [2] è¨˜äº‹ã«åˆã£ãŸç”»åƒã‚’3æšç”Ÿæˆ (pending)                        â”‚
â”‚   [3] è¨˜äº‹ã¨ç”»åƒã‚’HTMLã«ã¾ã¨ã‚ã‚‹ (pending)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚·ã‚¹ãƒ†ãƒ : ã€Œãƒ–ãƒ­ã‚°è¨˜äº‹ã®ãƒ†ãƒ¼ãƒã‚’ç¢ºèªã•ã›ã¦ãã ã•ã„ã€‚
          AIæŠ€è¡“å…¨èˆ¬ã§ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ
          ãã‚Œã¨ã‚‚ç‰¹å®šã®ãƒˆãƒ”ãƒƒã‚¯ï¼ˆç”ŸæˆAIã€æ©Ÿæ¢°å­¦ç¿’ãªã©ï¼‰ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿã€

ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œç”ŸæˆAIã®æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã§ã€

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TaskContext æ›´æ–°                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ purpose:                                                        â”‚
â”‚   clarified: "ç”ŸæˆAIã®æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã«é–¢ã™ã‚‹ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’ä½œæˆ..."    â”‚
â”‚   confirmedByUser: true  âœ“                                      â”‚
â”‚                                                                 â”‚
â”‚ state: "executing"                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[è‡ªå‹•å®Ÿè¡Œãƒ«ãƒ¼ãƒ—é–‹å§‹]

Step 1: ãƒ–ãƒ­ã‚°è¨˜äº‹ã®åŸ·ç­†
  â†’ textLLM ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘¼ã³å‡ºã—
  â†’ çµæœ: 2000æ–‡å­—ã®è¨˜äº‹ç”Ÿæˆ
  â†’ todos[1].status = "completed"
  â†’ history ã«è¨˜éŒ²

Step 2: ç”»åƒç”Ÿæˆ
  â†’ imageGen ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘¼ã³å‡ºã—
  â†’ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: "Rate limit exceeded"

[ã‚¨ãƒ©ãƒ¼è‡ªå‹•è£œæ­£]
  â†’ ErrorAnalysis: { type: "api_error", canAutoFix: true }
  â†’ RetryStrategy: { shouldRetry: true, backoffMs: 5000 }
  â†’ 5ç§’å¾…æ©Ÿå¾Œãƒªãƒˆãƒ©ã‚¤
  â†’ æˆåŠŸ: 3æšã®ç”»åƒç”Ÿæˆ
  â†’ todos[2].status = "completed"

Step 3: HTMLä½œæˆ
  â†’ ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ã§è¨˜äº‹ã¨ç”»åƒã‚’å–å¾—
  â†’ generateHtml ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘¼ã³å‡ºã—
  â†’ çµæœ: å®Œå…¨ãªHTMLãƒšãƒ¼ã‚¸ç”Ÿæˆ
  â†’ todos[3].status = "completed"

[attemptCompletion]
  â†’ å…¨ã¦ã®todoãŒ completed
  â†’ status: "completed"
  â†’ summary: "ç”ŸæˆAIã®æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã«é–¢ã™ã‚‹ãƒ–ãƒ­ã‚°è¨˜äº‹ã€
             ç”»åƒ3æšã€HTMLãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã—ãŸ"

ã‚·ã‚¹ãƒ†ãƒ : ã€Œå®Œäº†ã—ã¾ã—ãŸï¼ç”ŸæˆAIã®æœ€æ–°ãƒˆãƒ¬ãƒ³ãƒ‰ã«é–¢ã™ã‚‹ãƒ–ãƒ­ã‚°è¨˜äº‹ã€
          ç”»åƒ3æšã€HTMLãƒšãƒ¼ã‚¸ã‚’ä½œæˆã—ã¾ã—ãŸã€‚
          HTMLãƒšãƒ¼ã‚¸ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚ã€
```

##### ä¾‹2: ã‚¨ãƒ©ãƒ¼æ™‚ã®è‡ªå‹•è£œæ­£ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèª

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œæ±äº¬ã®å¤©æ°—ã‚’èª¿ã¹ã¦ã€ãã‚Œã«åˆã£ãŸæœè£…ã‚’ææ¡ˆã—ã¦ã€

[è‡ªå‹•å®Ÿè¡Œãƒ«ãƒ¼ãƒ—]

Step 1: å¤©æ°—æƒ…å ±å–å¾—
  â†’ weather ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘¼ã³å‡ºã—
  â†’ ã‚¨ãƒ©ãƒ¼: "Location ambiguous: æ±äº¬éƒ½ï¼Ÿæ±äº¬é§…ï¼Ÿ"

[ã‚¨ãƒ©ãƒ¼è‡ªå‹•è£œæ­£ã®åˆ¤æ–­]
  â†’ ErrorAnalysis: { type: "input_error", canAutoFix: false }
  â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªãŒå¿…è¦

ã‚·ã‚¹ãƒ†ãƒ : ã€Œã€æ±äº¬ã€ã®å ´æ‰€ã‚’ç‰¹å®šã§ãã¾ã›ã‚“ã§ã—ãŸã€‚
          ä»¥ä¸‹ã®ã©ã¡ã‚‰ã§ã™ã‹ï¼Ÿ
          1. æ±äº¬éƒ½ï¼ˆéƒ½å¿ƒéƒ¨ã®å¤©æ°—ï¼‰
          2. æ±äº¬é§…ï¼ˆãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆå¤©æ°—ï¼‰ã€

ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œ1ã€

[TaskContext æ›´æ–°ãƒ»å®Ÿè¡Œå†é–‹]
  â†’ æ±äº¬éƒ½ã®å¤©æ°—æƒ…å ±å–å¾—æˆåŠŸ
  â†’ ã€Œæ™´ã‚Œã€æœ€é«˜æ°—æ¸©28åº¦ã€æ¹¿åº¦60%ã€

Step 2: æœè£…ææ¡ˆ
  â†’ textLLM ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘¼ã³å‡ºã—
  â†’ ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã§å¤©æ°—æƒ…å ±ã‚’å–å¾—
  â†’ æœè£…ææ¡ˆç”Ÿæˆ

[attemptCompletion]
  â†’ status: "completed"
  â†’ summary: "æ±äº¬éƒ½ã¯æ™´ã‚Œã§28åº¦ã§ã™ã€‚
             è»½ã‚ã®ã‚·ãƒ£ãƒ„ã¨ãƒ‘ãƒ³ãƒ„ãŒãŠã™ã™ã‚ã§ã™ã€‚"
```

##### ä¾‹3: è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®ä¸¦è¡Œç®¡ç†

```
ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ã‚’ä½œã£ã¦ã€‚ã‚ã€ãã®å‰ã«ä»Šæ—¥ã®äºˆå®šã‚‚ç¢ºèªã—ãŸã„ã€

[ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ç®¡ç†]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TaskManager.getActiveTasks()                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Task 1 (task-001):                                              â”‚
â”‚   purpose: "ãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ã®ä½œæˆ"                                  â”‚
â”‚   state: "waiting_user"  â† è©³ç´°å¾…ã¡                             â”‚
â”‚   todos: [ãƒ†ãƒ¼ãƒæ±ºå®š, ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆ, ...]                         â”‚
â”‚                                                                 â”‚
â”‚ Task 2 (task-002):                                              â”‚
â”‚   purpose: "ä»Šæ—¥ã®äºˆå®šç¢ºèª"                                      â”‚
â”‚   state: "executing"  â† ç¾åœ¨å®Ÿè¡Œä¸­                              â”‚
â”‚   todos: [ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç¢ºèª]                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚·ã‚¹ãƒ†ãƒ : ã€Œ2ã¤ã®ã‚¿ã‚¹ã‚¯ã‚’ç®¡ç†ã—ã¦ã„ã¾ã™ã€‚
          ã¾ãšä»Šæ—¥ã®äºˆå®šã‚’ç¢ºèªã—ã¾ã™ã­ã€‚ã€

[Task 2 å®Ÿè¡Œ]
  â†’ calendar ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å‘¼ã³å‡ºã—
  â†’ ã€Œ10:00 ãƒãƒ¼ãƒ MTG, 14:00 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ‰“ã¡åˆã‚ã›ã€
  â†’ Task 2 å®Œäº†

ã‚·ã‚¹ãƒ†ãƒ : ã€Œä»Šæ—¥ã®äºˆå®š: 10:00 ãƒãƒ¼ãƒ MTG, 14:00 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ‰“ã¡åˆã‚ã›

          ã§ã¯ã€ãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ã®ä½œæˆã«æˆ»ã‚Šã¾ã™ã€‚
          ã©ã®ã‚ˆã†ãªãƒ†ãƒ¼ãƒã®ãƒ—ãƒ¬ã‚¼ãƒ³ã§ã™ã‹ï¼Ÿã€

[Task 1 ã«åˆ‡ã‚Šæ›¿ãˆ]
  â†’ TaskManager.switchTask("task-001")
  â†’ state: "waiting_user" â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›å¾…ã¡
```

##### ä¾‹4: ç›®çš„ã®ä¿®æ­£

```
[å®Ÿè¡Œä¸­ã®ã‚¿ã‚¹ã‚¯]
TaskContext:
  purpose: "å•†å“ç´¹ä»‹ãƒšãƒ¼ã‚¸ã®ä½œæˆ"
  state: "executing"
  todos:
    [1] å•†å“èª¬æ˜æ–‡ã®ä½œæˆ (completed)
    [2] å•†å“ç”»åƒã®ç”Ÿæˆ (in_progress)
    [3] HTMLãƒšãƒ¼ã‚¸ä½œæˆ (pending)

ãƒ¦ãƒ¼ã‚¶ãƒ¼: ã€Œã‚ã€ã‚„ã£ã±ã‚Šãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒšãƒ¼ã‚¸ã˜ã‚ƒãªãã¦ã€
          SNSæŠ•ç¨¿ç”¨ã®ç”»åƒã ã‘ã§ã„ã„ã‚„ã€

[ç›®çš„ã®ä¿®æ­£]
  â†’ TaskManager.updatePurpose("task-001", "SNSæŠ•ç¨¿ç”¨ã®å•†å“ç”»åƒä½œæˆ")

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TaskContext æ›´æ–°                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ purpose:                                                        â”‚
â”‚   original: "å•†å“ç´¹ä»‹ãƒšãƒ¼ã‚¸ã®ä½œæˆ"                               â”‚
â”‚   clarified: "SNSæŠ•ç¨¿ç”¨ã®å•†å“ç”»åƒä½œæˆ"  â† ä¿®æ­£                   â”‚
â”‚   confirmedByUser: true                                         â”‚
â”‚                                                                 â”‚
â”‚ todos:                                                          â”‚
â”‚   [1] å•†å“èª¬æ˜æ–‡ã®ä½œæˆ (completed) â†’ ãã®ã¾ã¾æ´»ç”¨                â”‚
â”‚   [2] SNSç”¨å•†å“ç”»åƒã®ç”Ÿæˆ (in_progress) â† æ–¹å‘æ€§ä¿®æ­£            â”‚
â”‚   [3] HTMLãƒšãƒ¼ã‚¸ä½œæˆ (pending) â†’ å‰Šé™¤                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚·ã‚¹ãƒ†ãƒ : ã€Œäº†è§£ã—ã¾ã—ãŸã€‚SNSæŠ•ç¨¿ç”¨ã®ç”»åƒä½œæˆã«å¤‰æ›´ã—ã¾ã™ã€‚
          å…ˆã»ã©ä½œæˆã—ãŸå•†å“èª¬æ˜ã‚’æ´»ã‹ã—ã¦ã€
          Instagramç”¨ã®ç”»åƒã‚’ç”Ÿæˆã—ã¾ã™ã­ã€‚ã€
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã®è‡ªå‹•å®Œäº†
- ã‚¨ãƒ©ãƒ¼æ™‚ã®è‡ªå‹•ãƒªã‚«ãƒãƒªãƒ¼
- è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®ä¸¦è¡Œç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æ„å›³ã®æ­£ç¢ºãªç†è§£ã¨å®Ÿè¡Œ

**è¨­è¨ˆè€ƒæ…®:**
- TaskContext ã¯æ°¸ç¶šåŒ–ã—ã¦ã‚»ãƒƒã‚·ãƒ§ãƒ³è·¨ãã§ç¶™ç¶šå¯èƒ½ã«
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ã¤ã§ã‚‚ã‚¿ã‚¹ã‚¯çŠ¶æ…‹ã‚’ç¢ºèªãƒ»ä¿®æ­£å¯èƒ½
- è‡ªå‹•å®Ÿè¡Œã®ä¸Šé™è¨­å®šï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
- é‡è¦ãªåˆ¤æ–­ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªã‚’æ±‚ã‚ã‚‹

---

#### 2. ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ï¼ˆInter-App Communicationï¼‰

**ç¾çŠ¶ã®å•é¡Œ:**
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã§ããªã„
- ã€Œã•ã£ãç”Ÿæˆã—ãŸç”»åƒã‚’ç·¨é›†ã—ã¦ã€ãŒã§ããªã„
- LLM ãŒéå»ã®ãƒ„ãƒ¼ãƒ«çµæœã‚’å‚ç…§ã§ããªã„

**å¿…è¦ãªæ©Ÿèƒ½:**
```typescript
interface ToolContext {
  // æ—¢å­˜
  currentResult?: ToolResult | null;
  app?: ToolContextApp;

  // è¿½åŠ 
  resources?: {
    getById: (uuid: string) => Resource | null;
    getByType: (type: ResourceType) => Resource[];
    getRecent: (count: number) => Resource[];
  };
}

type ResourceType = "image" | "document" | "data" | "audio" | "video";
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- LLM ãŒãƒ„ãƒ¼ãƒ«çµæœã‚’ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§é€£æºå¯èƒ½
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®è‡ªå‹•åŒ–
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å¤§å¹…å‘ä¸Š

**è¨­è¨ˆè€ƒæ…®:**
- ãƒªã‚½ãƒ¼ã‚¹ã®è»½é‡å‚ç…§ï¼ˆID + ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰ã¨å®Ÿãƒ‡ãƒ¼ã‚¿ã®åˆ†é›¢
- ãƒ¡ãƒ¢ãƒªåŠ¹ç‡ï¼ˆå¤§ããªãƒ‡ãƒ¼ã‚¿ã¯å¿…è¦æ™‚ã«ã®ã¿ãƒ­ãƒ¼ãƒ‰ï¼‰
- gui-chat-protocol ã¸ã®è¿½åŠ ï¼ˆãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªéä¾å­˜ï¼‰

---

#### 2. æ°¸ç¶šåŒ–ã®å¼·åŒ–ï¼ˆPersistent Storageï¼‰

**ç¾çŠ¶ã®å•é¡Œ:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ã§ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹
- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜ãŒã§ããªã„
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“ã§ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã§ããªã„

**å¿…è¦ãªæ©Ÿèƒ½:**
```typescript
interface ToolContextApp {
  // æ—¢å­˜
  getConfig: (key: string) => unknown;
  setConfig: (key: string, value: unknown) => void;

  // è¿½åŠ 
  storage: {
    // Key-Value ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    get: (key: string) => Promise<unknown>;
    set: (key: string, value: unknown) => Promise<void>;
    delete: (key: string) => Promise<void>;

    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    saveFile: (name: string, data: Blob) => Promise<string>;
    loadFile: (id: string) => Promise<Blob>;
    listFiles: (filter?: FileFilter) => Promise<FileInfo[]>;
  };
}
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- ã‚»ãƒƒã‚·ãƒ§ãƒ³è·¨ãã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæ¥­å±¥æ­´ä¿æŒ
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰åŸºç›¤

---

#### 4. MCP çµ±åˆã«ã‚ˆã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã®åŠ¹ç‡åŒ–

**ç¾çŠ¶ã®å•é¡Œ:**
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ¯å›ã‚¼ãƒ­ã‹ã‚‰ä½œæˆã™ã‚‹ã®ã¯å¤§å¤‰
- ãƒ„ãƒ¼ãƒ«ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰ã¨ UIï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰ãŒå¯†çµåˆ
- æ—¢å­˜ã® MCP ãƒ„ãƒ¼ãƒ«ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨ã§ãã¦ã„ãªã„

**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ§‹æˆè¦ç´ ã®åˆ†è§£:**

```
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ = Toolsï¼ˆæ©Ÿèƒ½ï¼‰ + Viewï¼ˆUIï¼‰

Tools:
  - ãƒ„ãƒ¼ãƒ«å®šç¾©ï¼ˆã‚¹ã‚­ãƒ¼ãƒï¼‰
  - å®Ÿè¡Œãƒ­ã‚¸ãƒƒã‚¯ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å‡¦ç†ï¼‰
  â†’ MCP ã§æä¾›å¯èƒ½

View:
  - ãƒ¡ã‚¤ãƒ³è¡¨ç¤ºï¼ˆView.vueï¼‰
  - ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆPreview.vueï¼‰
  â†’ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å›ºæœ‰
```

**MCPï¼ˆModel Context Protocolï¼‰ã¨ã¯:**

MCP ã¯ LLM ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ„ãƒ¼ãƒ«ã‚’æä¾›ã™ã‚‹ãŸã‚ã®æ¨™æº–ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã€‚
ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè£…ã—ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆLLM ã‚¢ãƒ—ãƒªï¼‰ã‹ã‚‰å‘¼ã³å‡ºã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¾çŠ¶: ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒã™ã¹ã¦ã‚’å®Ÿè£…                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Plugin                                                         â”‚
â”‚  â”œâ”€â”€ toolDefinition (è‡ªåˆ†ã§å®šç¾©)                                â”‚
â”‚  â”œâ”€â”€ execute() (è‡ªåˆ†ã§å®Ÿè£…)                                     â”‚
â”‚  â”œâ”€â”€ View.vue (è‡ªåˆ†ã§å®Ÿè£…)                                      â”‚
â”‚  â””â”€â”€ Preview.vue (è‡ªåˆ†ã§å®Ÿè£…)                                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ææ¡ˆ: MCP + UI ãƒ©ãƒƒãƒ‘ãƒ¼ã¨ã—ã¦ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  Plugin (è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼)                                          â”‚
â”‚  â”œâ”€â”€ mcpTool: "weather" (MCP ãƒ„ãƒ¼ãƒ«ã‚’å‚ç…§)                      â”‚
â”‚  â”œâ”€â”€ View.vue (UI ã ã‘å®Ÿè£…)                                     â”‚
â”‚  â””â”€â”€ Preview.vue (UI ã ã‘å®Ÿè£…)                                  â”‚
â”‚          â”‚                                                      â”‚
â”‚          â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  MCP Client (ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå±¤)              â”‚                   â”‚
â”‚  â”‚  - MCP ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š                     â”‚                   â”‚
â”‚  â”‚  - ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’ãƒ—ãƒ­ã‚­ã‚·               â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚          â”‚                                                      â”‚
â”‚          â–¼                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  MCP Server(s)                           â”‚                   â”‚
â”‚  â”‚  - Weather, Search, Database, etc.       â”‚                   â”‚
â”‚  â”‚  - æ—¢å­˜ã®ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’æ´»ç”¨               â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¿…è¦ãªæ©Ÿèƒ½:**

##### 4.1 MCP ãƒ„ãƒ¼ãƒ«ãƒ©ãƒƒãƒ‘ãƒ¼å‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

```typescript
// å¾“æ¥: ã™ã¹ã¦è‡ªåˆ†ã§å®Ÿè£…
export const pluginCore: ToolPluginCore = {
  toolDefinition: {
    name: "weather",
    description: "Get weather information",
    parameters: { /* ã‚¹ã‚­ãƒ¼ãƒå®šç¾© */ }
  },
  execute: async (context, args) => {
    // å¤©æ°— API ã‚’è‡ªåˆ†ã§å‘¼ã³å‡ºã—
    const data = await fetchWeatherAPI(args.location);
    return { message: "Weather fetched", data };
  },
};

// ææ¡ˆ: MCP ãƒ„ãƒ¼ãƒ«ã‚’å‚ç…§
export const pluginCore: ToolPluginCore = {
  // MCP ãƒ„ãƒ¼ãƒ«ã‚’å‚ç…§ï¼ˆtoolDefinition ã¯ MCP ã‹ã‚‰å–å¾—ï¼‰
  mcpTool: {
    server: "weather-server",  // MCP ã‚µãƒ¼ãƒãƒ¼å
    tool: "get_weather",       // ãƒ„ãƒ¼ãƒ«å
  },

  // execute ã¯è‡ªå‹•ç”Ÿæˆã¾ãŸã¯çœç•¥å¯èƒ½
  // MCP ãƒ„ãƒ¼ãƒ«ã®çµæœã‚’ UI ç”¨ã«å¤‰æ›ã™ã‚‹å ´åˆã®ã¿å®Ÿè£…
  transformResult: (mcpResult) => ({
    message: mcpResult.content,
    data: { temperature: mcpResult.temperature, ... }
  }),
};
```

##### 4.2 MCP ã‚µãƒ¼ãƒãƒ¼ç®¡ç†

```typescript
interface ToolContextApp {
  // æ—¢å­˜ã®æ©Ÿèƒ½...

  // MCP é–¢é€£
  mcp: {
    // åˆ©ç”¨å¯èƒ½ãª MCP ã‚µãƒ¼ãƒãƒ¼ä¸€è¦§
    listServers: () => MCPServerInfo[];

    // MCP ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—
    callTool: (server: string, tool: string, args: unknown) => Promise<MCPResult>;

    // MCP ãƒ„ãƒ¼ãƒ«å®šç¾©å–å¾—
    getToolDefinition: (server: string, tool: string) => ToolDefinition;
  };
}
```

##### 4.3 ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç¨®åˆ¥

```typescript
// 1. ãƒ•ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆå¾“æ¥é€šã‚Šï¼‰
interface FullPlugin extends ToolPluginCore {
  toolDefinition: ToolDefinition;
  execute: ExecuteFunction;
  viewComponent: Component;
  previewComponent: Component;
}

// 2. MCP ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆæ–°è¦ï¼‰
interface MCPWrapperPlugin {
  // MCP ãƒ„ãƒ¼ãƒ«å‚ç…§
  mcpTool: {
    server: string;
    tool: string;
  };

  // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: çµæœã®å¤‰æ›
  transformResult?: (mcpResult: unknown) => ToolResult;

  // UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  viewComponent: Component;
  previewComponent?: Component;
}

// 3. UI ã‚ªãƒ³ãƒªãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆMCP ãƒ„ãƒ¼ãƒ«ã« UI ã‚’è¿½åŠ ï¼‰
interface UIOnlyPlugin {
  // æ—¢å­˜ã® MCP ãƒ„ãƒ¼ãƒ«ã¾ãŸã¯ä»–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒ„ãƒ¼ãƒ«ã‚’å‚ç…§
  toolRef: string;  // "mcp:weather-server/get_weather" or "plugin:weather"

  // UI ã®ã¿æä¾›
  viewComponent: Component;
  previewComponent?: Component;
}
```

**å…·ä½“ä¾‹:**

##### ä¾‹1: æ—¢å­˜ MCP ãƒ„ãƒ¼ãƒ«ã« UI ã‚’è¿½åŠ 

```
[çŠ¶æ³]
- MCP ã‚µãƒ¼ãƒãƒ¼ "exa-search" ãŒæ—¢ã«å­˜åœ¨
- search ãƒ„ãƒ¼ãƒ«ã‚’æä¾›
- ã—ã‹ã— UI ãŒãªã„ï¼ˆãƒ†ã‚­ã‚¹ãƒˆçµæœã®ã¿ï¼‰

[è§£æ±ºç­–: UI ã‚ªãƒ³ãƒªãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³]

// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®šç¾©ï¼ˆæœ€å°é™ï¼‰
export const plugin: UIOnlyPlugin = {
  toolRef: "mcp:exa-search/search",

  viewComponent: SearchResultsView,  // ã‚«ãƒ¼ãƒ‰å½¢å¼ã§çµæœè¡¨ç¤º
  previewComponent: SearchPreview,   // ã‚µãƒ ãƒã‚¤ãƒ«
};

// View.vue ã ã‘å®Ÿè£…
<template>
  <div class="search-results">
    <div v-for="result in results" class="result-card">
      <h3>{{ result.title }}</h3>
      <p>{{ result.snippet }}</p>
      <a :href="result.url">è©³ç´°</a>
    </div>
  </div>
</template>
```

##### ä¾‹2: MCP ãƒ„ãƒ¼ãƒ« + ã‚«ã‚¹ã‚¿ãƒ å¾Œå‡¦ç†

```
[çŠ¶æ³]
- MCP ã‚µãƒ¼ãƒãƒ¼ "weather" ãŒæ°—è±¡ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™
- ã—ã‹ã—ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¯ã€Œæœè£…ææ¡ˆã€ã‚‚è¡¨ç¤ºã—ãŸã„

[è§£æ±ºç­–: MCP ãƒ©ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ with transformResult]

export const pluginCore: MCPWrapperPlugin = {
  mcpTool: {
    server: "weather",
    tool: "get_current_weather",
  },

  // MCP çµæœã‚’åŠ å·¥
  transformResult: async (mcpResult, context) => {
    const weather = mcpResult;

    // textLLM ã§æœè£…ææ¡ˆã‚’ç”Ÿæˆ
    const suggestion = await context.app?.generateText({
      prompt: `æ°—æ¸©${weather.temperature}åº¦ã€${weather.condition}ã®æ—¥ã®æœè£…ã‚’ææ¡ˆã—ã¦`,
    });

    return {
      message: `${weather.location}: ${weather.temperature}åº¦`,
      data: {
        weather,
        clothingSuggestion: suggestion,
      },
    };
  },
};
```

##### ä¾‹3: è¤‡æ•° MCP ãƒ„ãƒ¼ãƒ«ã®çµ„ã¿åˆã‚ã›

```
[çŠ¶æ³]
- "search" MCP ã‚µãƒ¼ãƒãƒ¼: Web æ¤œç´¢
- "browser" MCP ã‚µãƒ¼ãƒãƒ¼: ãƒšãƒ¼ã‚¸å–å¾—
- ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã¦ã€Œæ¤œç´¢ã—ã¦è¦ç´„ã€ã—ãŸã„

[è§£æ±ºç­–: ãƒ•ãƒ«ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ with MCP å‘¼ã³å‡ºã—]

export const pluginCore: ToolPluginCore = {
  toolDefinition: {
    name: "search_and_summarize",
    description: "Search and summarize results",
    parameters: { query: { type: "string" } }
  },

  execute: async (context, args) => {
    // 1. MCP ã§æ¤œç´¢
    const searchResults = await context.app?.mcp.callTool(
      "search", "web_search", { query: args.query }
    );

    // 2. ä¸Šä½3ä»¶ã®ãƒšãƒ¼ã‚¸ã‚’å–å¾—
    const pages = await Promise.all(
      searchResults.slice(0, 3).map(r =>
        context.app?.mcp.callTool("browser", "fetch_page", { url: r.url })
      )
    );

    // 3. textLLM ã§è¦ç´„
    const summary = await context.app?.generateText({
      prompt: `ä»¥ä¸‹ã®æƒ…å ±ã‚’è¦ç´„ã—ã¦:\n${pages.join('\n')}`
    });

    return {
      message: "Search and summarize completed",
      data: { searchResults, summary },
    };
  },
};
```

**é–‹ç™ºãƒ•ãƒ­ãƒ¼ã®å¤‰åŒ–:**

```
å¾“æ¥ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™º:
1. ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’æ›¸ã
2. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ API ã‚’èª¿æŸ»ãƒ»å®Ÿè£…
3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’å®Ÿè£…
4. View/Preview ã‚’å®Ÿè£…
5. ãƒ†ã‚¹ãƒˆ
â†’ 1-2æ—¥ã‹ã‹ã‚‹

MCP çµ±åˆå¾Œã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™º:
1. æ—¢å­˜ MCP ãƒ„ãƒ¼ãƒ«ã‚’æ¢ã™ï¼ˆã¾ãŸã¯ä½œã‚‹ï¼‰
2. View/Preview ã‚’å®Ÿè£…
3. å¿…è¦ãªã‚‰ transformResult ã‚’å®Ÿè£…
â†’ æ•°æ™‚é–“ã§å®Œäº†
```

**ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¸ã®å½±éŸ¿:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤                            â”‚
â”‚               (ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ / LLM Native Apps)                     â”‚
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚FullPlugin â”‚  â”‚MCP Wrapperâ”‚  â”‚ UI Only   â”‚                 â”‚
â”‚   â”‚(å¾“æ¥å‹)    â”‚  â”‚ Plugin    â”‚  â”‚ Plugin    â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      OS å±¤ï¼ˆCoreï¼‰                               â”‚
â”‚                    gui-chat-protocol                            â”‚
â”‚                                                                 â”‚
â”‚  ãƒ»ToolPluginCore / MCPWrapperPlugin / UIOnlyPlugin å‹å®šç¾©      â”‚
â”‚  ãƒ»MCP Client ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå±¤                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  MCP Client å®Ÿè£…                         â”‚                   â”‚
â”‚  â”‚  - ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç®¡ç†                       â”‚                   â”‚
â”‚  â”‚  - ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ãƒ—ãƒ­ã‚­ã‚·                 â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                   ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å±¤                                 â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  MCP    â”‚  â”‚  MCP    â”‚  â”‚  MCP    â”‚  â”‚ Direct  â”‚          â”‚
â”‚  â”‚ Server  â”‚  â”‚ Server  â”‚  â”‚ Server  â”‚  â”‚  API    â”‚          â”‚
â”‚  â”‚(Weather)â”‚  â”‚(Search) â”‚  â”‚(Browser)â”‚  â”‚(Legacy) â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºæ™‚é–“ã®å¤§å¹…çŸ­ç¸®ï¼ˆUI å®Ÿè£…ã ã‘ã§OKï¼‰
- MCP ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®æ´»ç”¨ï¼ˆæ—¢å­˜ãƒ„ãƒ¼ãƒ«ã®å†åˆ©ç”¨ï¼‰
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰/ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®æ˜ç¢ºãªåˆ†é›¢
- ãƒ„ãƒ¼ãƒ«ã®å…±æœ‰ãƒ»å†åˆ©ç”¨ãŒå®¹æ˜“ã«

**è¨­è¨ˆè€ƒæ…®:**
- MCP ã‚µãƒ¼ãƒãƒ¼ã®æ¥ç¶šç®¡ç†ã‚’ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå±¤ã§è¡Œã†
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ MCP ã‚’æ„è­˜ã›ãšã€context.app.mcp çµŒç”±ã§å‘¼ã³å‡ºã—
- MCP éå¯¾å¿œã®æ—¢å­˜ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã®äº’æ›æ€§ç¶­æŒ
- MCP ã‚µãƒ¼ãƒãƒ¼ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼ˆä¿¡é ¼ã§ãã‚‹ã‚µãƒ¼ãƒãƒ¼ã®ã¿æ¥ç¶šï¼‰

##### 4.4 ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜ï¼ˆRFC çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼‰

**èª²é¡Œ:**
æ—¢å­˜ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®æ•´åˆæ€§ã‚’ä¿è¨¼ã™ã‚‹ä»•çµ„ã¿ãŒãªã„ã€‚

**ææ¡ˆ: çµ±ä¸€ãƒ„ãƒ¼ãƒ«è­˜åˆ¥å­ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜**

```typescript
// ãƒ„ãƒ¼ãƒ«ã®ä¸€æ„è­˜åˆ¥å­
type ToolURI = string;  // ä¾‹: "guichat://weather/get_current"
                        //     "mcp://exa-search/search"
                        //     "plugin://othello/make_move"

// ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜
interface ToolSpec {
  // è­˜åˆ¥å­
  uri: ToolURI;
  version: string;  // ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚° "1.0.0"

  // ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©ï¼ˆJSON Schema ãƒ™ãƒ¼ã‚¹ï¼‰
  input: JSONSchema;
  output: JSONSchema;

  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  metadata: {
    name: string;
    description: string;
    category: string;
    capabilities?: ToolCapabilities;
  };
}
```

**ãƒ„ãƒ¼ãƒ«ç™»éŒ²ãƒ¬ã‚¸ã‚¹ãƒˆãƒª:**

```typescript
interface ToolRegistry {
  // ãƒ„ãƒ¼ãƒ«ç™»éŒ²
  register: (spec: ToolSpec, implementation: ToolImplementation) => void;

  // ãƒ„ãƒ¼ãƒ«æ¤œç´¢
  lookup: (uri: ToolURI) => ToolSpec | null;
  search: (query: { category?: string; capability?: string }) => ToolSpec[];

  // ãƒãƒ¼ã‚¸ãƒ§ãƒ³äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
  isCompatible: (required: ToolURI, available: ToolURI) => boolean;
}
```

**æ—¢å­˜ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã®æ•´åˆæ€§:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ—¢å­˜ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ â†’ ToolSpec ç”Ÿæˆ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  // æ—¢å­˜ã® weather ãƒ—ãƒ©ã‚°ã‚¤ãƒ³                                    â”‚
â”‚  export const pluginCore = {                                    â”‚
â”‚    toolDefinition: { name: "weather", ... },                    â”‚
â”‚    execute: async (ctx, args) => { ... }                        â”‚
â”‚  };                                                             â”‚
â”‚                                                                 â”‚
â”‚  â†“ è‡ªå‹•å¤‰æ›                                                     â”‚
â”‚                                                                 â”‚
â”‚  ToolSpec {                                                     â”‚
â”‚    uri: "plugin://weather/get_weather",                         â”‚
â”‚    version: "1.0.0",                                            â”‚
â”‚    input: { /* toolDefinition.parameters ã‹ã‚‰ç”Ÿæˆ */ },         â”‚
â”‚    output: { /* ToolResult ã‚¹ã‚­ãƒ¼ãƒ */ },                        â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MCP ãƒ„ãƒ¼ãƒ« â†’ ToolSpec ãƒãƒƒãƒ”ãƒ³ã‚°                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  MCP Server "exa-search" ã® "search" ãƒ„ãƒ¼ãƒ«                     â”‚
â”‚                                                                 â”‚
â”‚  â†“ è‡ªå‹•ãƒãƒƒãƒ”ãƒ³ã‚°                                               â”‚
â”‚                                                                 â”‚
â”‚  ToolSpec {                                                     â”‚
â”‚    uri: "mcp://exa-search/search",                              â”‚
â”‚    version: "1.0.0",                                            â”‚
â”‚    input: { /* MCP ãƒ„ãƒ¼ãƒ«ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ */ },                      â”‚
â”‚    output: { /* MCP çµæœã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ */ },                       â”‚
â”‚  }                                                              â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç›¸äº’é‹ç”¨æ€§ã®å®Ÿç¾:**

```typescript
// UI ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒä»»æ„ã®ãƒ„ãƒ¼ãƒ«ã‚’å‚ç…§
export const plugin: UIOnlyPlugin = {
  // ToolURI ã§å‚ç…§ï¼ˆå®Ÿè£…ãŒãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ MCP ã‹ã‚’æ„è­˜ã—ãªã„ï¼‰
  toolRef: "guichat://weather/get_current",  // or "mcp://..." or "plugin://..."

  viewComponent: WeatherView,
};

// ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªãŒé©åˆ‡ãªå®Ÿè£…ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
const result = await toolRegistry.execute("guichat://weather/get_current", args);
// â†’ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å®Ÿè£…ã‹ MCP å®Ÿè£…ã‹ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªãŒè§£æ±º
```

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã¨äº’æ›æ€§:**

```typescript
// ãƒ„ãƒ¼ãƒ«ä»•æ§˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†
const spec_v1: ToolSpec = {
  uri: "guichat://weather/get_current",
  version: "1.0.0",
  input: { location: "string" },
  output: { temperature: "number", condition: "string" },
};

const spec_v2: ToolSpec = {
  uri: "guichat://weather/get_current",
  version: "2.0.0",
  input: { location: "string", unit: "celsius | fahrenheit" },  // è¿½åŠ 
  output: { temperature: "number", condition: "string", humidity: "number" },  // è¿½åŠ 
};

// äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
toolRegistry.isCompatible("guichat://weather/get_current@^1.0.0", spec_v2);
// â†’ trueï¼ˆå¾Œæ–¹äº’æ›ã‚ã‚Šï¼‰
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- æ—¢å­˜ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ MCP ãƒ„ãƒ¼ãƒ«ã®çµ±ä¸€çš„ãªæ‰±ã„
- ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ˜ç¤ºçš„ãªä»•æ§˜åŒ–ï¼ˆRFC çš„ï¼‰
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã«ã‚ˆã‚‹äº’æ›æ€§ä¿è¨¼
- ãƒ„ãƒ¼ãƒ«ã®ç™ºè¦‹ãƒ»æ¤œç´¢ãŒå®¹æ˜“ã«

---

### å„ªå…ˆåº¦: ä¸­ ğŸŸ¡

#### 5. çµ±ä¸€è¨­å®šã‚·ã‚¹ãƒ†ãƒ ï¼ˆConfiguration Systemï¼‰

**ç¾çŠ¶ã®ä»•çµ„ã¿:**

ç¾åœ¨ã® MulmoChat ã§ã¯ä»¥ä¸‹ã®è¨­å®šãƒ•ãƒ­ãƒ¼ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹:

```
localStorage ("plugin_configs_v1")
    â†“
useUserPreferences (çŠ¶æ…‹ç®¡ç†)
    â†“
HomeView.vue (getPluginConfig é–¢æ•°å®šç¾©)
    â†“
useToolResults (ToolContext æ§‹ç¯‰)
    â†“
context.app.getConfig() / setConfig()
    â†“
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ / ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
```

**ç¾çŠ¶ã®èª²é¡Œ:**
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã”ã¨ã«è¨­å®šã‚¹ã‚­ãƒ¼ãƒãŒæ˜ç¤ºçš„ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è¨­å®šï¼ˆã©ã® API ã‚’ä½¿ã†ã‹ç­‰ï¼‰ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŒã¡
- è¨­å®š UI ã®ç”ŸæˆãŒãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã”ã¨ã«æ‰‹å‹•
- è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒä¸çµ±ä¸€
- è¨­å®šã®ä¾å­˜é–¢ä¿‚ï¼ˆä¾‹: imageGen ã®å ´åˆã¯ API ã‚­ãƒ¼ãŒå¿…è¦ï¼‰ãŒè¡¨ç¾ã§ããªã„

**å¿…è¦ãªæ©Ÿèƒ½:**

##### 5.1 ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®šã‚¹ã‚­ãƒ¼ãƒ

```typescript
interface ToolPluginCore {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...

  // è¿½åŠ : è¨­å®šã‚¹ã‚­ãƒ¼ãƒ
  configSchema?: ConfigSchema;
}

interface ConfigSchema {
  // è¨­å®šã®ä¸€æ„ã‚­ãƒ¼
  key: string;  // "imageGenerationBackend", "weather.location"

  // JSON Schema ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
  schema: JSONSchema;

  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤
  defaultValue: unknown;

  // UI ãƒ’ãƒ³ãƒˆ
  ui?: {
    label: string;
    description?: string;
    component?: "select" | "input" | "toggle" | "slider" | "custom";
    group?: string;  // è¨­å®šã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆ"backend", "appearance" ãªã©ï¼‰
  };

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  validate?: (value: unknown) => ValidationResult;

  // ä¾å­˜é–¢ä¿‚
  dependencies?: ConfigDependency[];
}

interface ConfigDependency {
  // ä¾å­˜ã™ã‚‹è¨­å®šã‚­ãƒ¼
  key: string;
  // æ¡ä»¶
  condition: "exists" | "equals" | "notEquals";
  value?: unknown;
}
```

##### 5.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šã‚¹ã‚­ãƒ¼ãƒ

```typescript
interface BackendConfig {
  // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ç¨®åˆ¥
  type: BackendType;  // "textLLM", "imageGen", etc.

  // åˆ©ç”¨å¯èƒ½ãªãƒ—ãƒ­ãƒã‚¤ãƒ€
  providers: ProviderConfig[];

  // é¸æŠä¸­ã®ãƒ—ãƒ­ãƒã‚¤ãƒ€
  selectedProvider: string;
}

interface ProviderConfig {
  id: string;           // "anthropic", "openai", "gemini"
  name: string;         // è¡¨ç¤ºå
  configSchema: ConfigSchema[];  // ãƒ—ãƒ­ãƒã‚¤ãƒ€å›ºæœ‰ã®è¨­å®š

  // API ã‚­ãƒ¼ãªã©ã®å¿…é ˆè¨­å®š
  requiredSecrets?: SecretConfig[];
}

interface SecretConfig {
  key: string;           // "ANTHROPIC_API_KEY"
  label: string;         // "Anthropic API Key"
  description?: string;
  envVar?: string;       // ç’°å¢ƒå¤‰æ•°åï¼ˆã‚µãƒ¼ãƒãƒ¼å´ã§è¨­å®šæ¸ˆã¿ã®å ´åˆï¼‰
}
```

##### 5.3 è¨­å®š UI ã®è‡ªå‹•ç”Ÿæˆ

```typescript
interface ToolContextApp {
  // æ—¢å­˜ã®æ©Ÿèƒ½...
  getConfig: <T>(key: string) => T | undefined;
  setConfig: (key: string, value: unknown) => void;

  // è¿½åŠ : è¨­å®šãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  config: {
    // ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ UI ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹ãŸã‚ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿å–å¾—
    getSchema: (key: string) => ConfigSchema | undefined;

    // å…¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®šã‚¹ã‚­ãƒ¼ãƒä¸€è¦§
    getAllSchemas: () => ConfigSchema[];

    // ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šã®å–å¾—
    getBackendConfig: (type: BackendType) => BackendConfig;

    // è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    validate: (key: string, value: unknown) => ValidationResult;

    // è¨­å®šå¤‰æ›´ã®è³¼èª­
    subscribe: (key: string, callback: (value: unknown) => void) => () => void;
  };
}
```

**å…·ä½“ä¾‹:**

##### ä¾‹1: ç”»åƒç”Ÿæˆãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®š

```typescript
// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å´ã§è¨­å®šã‚¹ã‚­ãƒ¼ãƒã‚’å®£è¨€
export const pluginCore: ToolPluginCore = {
  toolDefinition: { /* ... */ },
  execute: async (context, args) => { /* ... */ },

  // è¨­å®šã‚¹ã‚­ãƒ¼ãƒ
  configSchema: {
    key: "imageGenerationBackend",
    schema: {
      type: "object",
      properties: {
        backend: {
          type: "string",
          enum: ["gemini", "openai", "comfyui"],
          default: "gemini"
        },
        styleModifier: {
          type: "string",
          default: ""
        },
        geminiModel: {
          type: "string",
          enum: ["gemini-2.5-flash-image", "imagen-3.0"],
          default: "gemini-2.5-flash-image"
        }
      }
    },
    defaultValue: {
      backend: "gemini",
      styleModifier: "",
      geminiModel: "gemini-2.5-flash-image"
    },
    ui: {
      label: "ç”»åƒç”Ÿæˆè¨­å®š",
      group: "backend",
      component: "custom"  // ã‚«ã‚¹ã‚¿ãƒ  UI ã‚’ä½¿ç”¨
    },
    dependencies: [
      {
        key: "secrets.GOOGLE_AI_API_KEY",
        condition: "exists"
      }
    ]
  }
};
```

##### ä¾‹2: å¤©æ°—ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¨­å®š

```typescript
export const pluginCore: ToolPluginCore = {
  toolDefinition: { /* ... */ },
  execute: async (context, args) => { /* ... */ },

  configSchema: {
    key: "weather.preferences",
    schema: {
      type: "object",
      properties: {
        unit: {
          type: "string",
          enum: ["celsius", "fahrenheit"],
          default: "celsius"
        },
        defaultLocation: {
          type: "string",
          default: ""
        }
      }
    },
    defaultValue: {
      unit: "celsius",
      defaultLocation: ""
    },
    ui: {
      label: "å¤©æ°—è¨­å®š",
      group: "plugins",
      description: "å¤©æ°—ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¡¨ç¤ºè¨­å®š"
    }
  }
};
```

##### ä¾‹3: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®è¨­å®š

```typescript
// ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå´ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šã‚’å®šç¾©
const textLLMBackendConfig: BackendConfig = {
  type: "textLLM",
  providers: [
    {
      id: "anthropic",
      name: "Claude (Anthropic)",
      configSchema: [
        {
          key: "textLLM.anthropic.model",
          schema: {
            type: "string",
            enum: ["claude-3-5-sonnet", "claude-3-opus"],
            default: "claude-3-5-sonnet"
          },
          ui: { label: "ãƒ¢ãƒ‡ãƒ«" }
        }
      ],
      requiredSecrets: [
        {
          key: "ANTHROPIC_API_KEY",
          label: "Anthropic API Key",
          envVar: "ANTHROPIC_API_KEY"
        }
      ]
    },
    {
      id: "openai",
      name: "GPT (OpenAI)",
      configSchema: [
        {
          key: "textLLM.openai.model",
          schema: {
            type: "string",
            enum: ["gpt-4o", "gpt-4-turbo"],
            default: "gpt-4o"
          },
          ui: { label: "ãƒ¢ãƒ‡ãƒ«" }
        }
      ],
      requiredSecrets: [
        {
          key: "OPENAI_API_KEY",
          label: "OpenAI API Key"
        }
      ]
    }
  ],
  selectedProvider: "anthropic"
};
```

**ã‚¢ãƒ—ãƒªå´ã§ã®è¨­å®š UI è‡ªå‹•ç”Ÿæˆ:**

```vue
<!-- SettingsPanel.vue -->
<template>
  <div class="settings-panel">
    <!-- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¨­å®š -->
    <section v-for="schema in pluginSchemas" :key="schema.key">
      <h3>{{ schema.ui?.label }}</h3>

      <!-- ã‚¹ã‚­ãƒ¼ãƒã«åŸºã¥ã„ã¦ UI ã‚’è‡ªå‹•ç”Ÿæˆ -->
      <ConfigField
        :schema="schema"
        :value="getConfig(schema.key)"
        @update="setConfig(schema.key, $event)"
      />
    </section>

    <!-- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®š -->
    <section v-for="backend in backendConfigs" :key="backend.type">
      <h3>{{ backend.type }} ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰</h3>

      <select v-model="backend.selectedProvider">
        <option
          v-for="provider in backend.providers"
          :key="provider.id"
          :value="provider.id"
        >
          {{ provider.name }}
        </option>
      </select>

      <!-- é¸æŠã•ã‚ŒãŸãƒ—ãƒ­ãƒã‚¤ãƒ€ã®è¨­å®š -->
      <ConfigField
        v-for="config in selectedProviderConfigs(backend)"
        :schema="config"
        :value="getConfig(config.key)"
        @update="setConfig(config.key, $event)"
      />
    </section>
  </div>
</template>
```

**ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ / ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰                                                    â”‚
â”‚                                                                             â”‚
â”‚  configSchema: {                                                            â”‚
â”‚    key: "imageGenerationBackend",                                          â”‚
â”‚    schema: { type: "object", ... },                                        â”‚
â”‚    ui: { label: "ç”»åƒç”Ÿæˆè¨­å®š", ... }                                        â”‚
â”‚  }                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“ ã‚¹ã‚­ãƒ¼ãƒã‚’åé›†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå±¤ï¼ˆMulmoChatï¼‰                                                  â”‚
â”‚                                                                             â”‚
â”‚  1. å…¨ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã® configSchema ã‚’åé›†                                       â”‚
â”‚  2. ã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰è¨­å®š UI ã‚’è‡ªå‹•ç”Ÿæˆ                                            â”‚
â”‚  3. è¨­å®šå€¤ã‚’ localStorage ã«æ°¸ç¶šåŒ–                                          â”‚
â”‚  4. context.app.getConfig() ã§å€¤ã‚’æä¾›                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â†“ UI è‡ªå‹•ç”Ÿæˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¨­å®šç”»é¢ï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰                                                         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ ç”»åƒç”Ÿæˆè¨­å®š                         â”‚                                   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                   â”‚
â”‚  â”‚ â”‚ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: [Gemini â–¼]        â”‚ â”‚                                   â”‚
â”‚  â”‚ â”‚ ã‚¹ã‚¿ã‚¤ãƒ«: [________________]     â”‚ â”‚                                   â”‚
â”‚  â”‚ â”‚ ãƒ¢ãƒ‡ãƒ«: [gemini-2.5-flash â–¼]    â”‚ â”‚                                   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ å¤©æ°—è¨­å®š                             â”‚                                   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                                   â”‚
â”‚  â”‚ â”‚ å˜ä½: â—‹ æ‘‚æ° â— è¯æ°             â”‚ â”‚                                   â”‚
â”‚  â”‚ â”‚ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåœ°åŸŸ: [æ±äº¬___]        â”‚ â”‚                                   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºè€…ã¯è¨­å®šã‚¹ã‚­ãƒ¼ãƒã‚’å®£è¨€ã™ã‚‹ã ã‘
- è¨­å®š UI ã®å®Ÿè£…å·¥æ•°å‰Šæ¸›
- è¨­å®šã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒçµ±ä¸€
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šã®ä¸€å…ƒç®¡ç†
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã®å‘ä¸Šï¼ˆä¸€è²«ã—ãŸè¨­å®š UIï¼‰

**è¨­è¨ˆè€ƒæ…®:**
- æ—¢å­˜ã® getConfig/setConfig ã¨ã®å¾Œæ–¹äº’æ›æ€§ã‚’ç¶­æŒ
- ã‚«ã‚¹ã‚¿ãƒ  UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚‚ã‚µãƒãƒ¼ãƒˆï¼ˆcomponent: "custom"ï¼‰
- ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆï¼ˆAPI ã‚­ãƒ¼ç­‰ï¼‰ã¯åˆ¥ç®¡ç†ï¼ˆç’°å¢ƒå¤‰æ•° or æš—å·åŒ–ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼‰
- è¨­å®šå¤‰æ›´æ™‚ã®ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªæ›´æ–°

---

#### 6. ãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½å®£è¨€ï¼ˆCapabilitiesï¼‰

**ç¾çŠ¶ã®å•é¡Œ:**
- LLM ãŒãƒ„ãƒ¼ãƒ«ã®å…¥å‡ºåŠ›ã‚’æ­£ç¢ºã«æŠŠæ¡ã§ããªã„
- é©åˆ‡ãªãƒ„ãƒ¼ãƒ«é¸æŠãŒé›£ã—ã„

**å¿…è¦ãªæ©Ÿèƒ½:**
```typescript
interface ToolCapabilities {
  inputTypes?: ResourceType[];   // å—ã‘ä»˜ã‘ã‚‹å…¥åŠ›
  outputType?: ResourceType;     // å‡ºåŠ›ã®ç¨®é¡
  streaming?: boolean;           // ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯¾å¿œ
  undoable?: boolean;            // å–ã‚Šæ¶ˆã—å¯èƒ½
  sideEffects?: boolean;         // å‰¯ä½œç”¨ã‚ã‚Š
}
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- LLM ã®ãƒ„ãƒ¼ãƒ«é¸æŠç²¾åº¦å‘ä¸Š
- ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº
- ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªã® UI æœ€é©åŒ–

---

#### 7. Undo/Redo / å±¥æ­´ç®¡ç†

**ç¾çŠ¶ã®å•é¡Œ:**
- ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œã‚’å–ã‚Šæ¶ˆã›ãªã„
- çŠ¶æ…‹ã®å·»ãæˆ»ã—ãŒã§ããªã„

**å¿…è¦ãªæ©Ÿèƒ½:**
```typescript
interface ToolResult {
  // æ—¢å­˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰...

  // è¿½åŠ 
  undoable?: boolean;
  undo?: () => Promise<void>;
}

interface ToolContext {
  history?: {
    canUndo: boolean;
    canRedo: boolean;
    undo: () => Promise<void>;
    redo: () => Promise<void>;
  };
}
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- å®‰å¿ƒã—ã¦è©¦è¡ŒéŒ¯èª¤ã§ãã‚‹ç’°å¢ƒ
- è¤‡é›‘ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç®¡ç†

---

#### 8. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯ / é€šçŸ¥

**ç¾çŠ¶ã®å•é¡Œ:**
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯å‘¼ã°ã‚ŒãŸæ™‚ã ã‘å‹•ã
- é•·æ™‚é–“å‡¦ç†ã®é€²æ—è¡¨ç¤ºãŒãªã„
- ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªé€šçŸ¥ãŒã§ããªã„

**å¿…è¦ãªæ©Ÿèƒ½:**
```typescript
interface ToolContextApp {
  // è¿½åŠ 
  tasks: {
    run: (task: BackgroundTask) => TaskHandle;
    cancel: (handle: TaskHandle) => void;
  };

  notifications: {
    show: (notification: Notification) => void;
    requestPermission: () => Promise<boolean>;
  };
}
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- é•·æ™‚é–“å‡¦ç†ï¼ˆå‹•ç”»ç”Ÿæˆç­‰ï¼‰ã® UX å‘ä¸Š
- ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãª AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ

---

### å„ªå…ˆåº¦: ä½ ğŸŸ¢

#### 9. ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ 

**å¿…è¦ãªæ©Ÿèƒ½:**
```typescript
interface ToolPluginCore {
  // è¿½åŠ 
  permissions?: Permission[];
}

type Permission =
  | "network"      // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¯ã‚»ã‚¹
  | "storage"      // ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¢ã‚¯ã‚»ã‚¹
  | "camera"       // ã‚«ãƒ¡ãƒ©ã‚¢ã‚¯ã‚»ã‚¹
  | "location"     // ä½ç½®æƒ…å ±
  | "notifications"; // é€šçŸ¥
```

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¿¡é ¼ã®ç²å¾—
- ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å®‰å…¨ãªå°å…¥

---

#### 10. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹

**å¿…è¦ãªæ©Ÿèƒ½:**
- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™ºè¦‹ãƒ»æ¤œç´¢
- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«/ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ»è‡ªå‹•æ›´æ–°
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»è©•ä¾¡

**ã‚¤ãƒ³ãƒ‘ã‚¯ãƒˆ:**
- ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®å½¢æˆ
- é–‹ç™ºè€…ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®æ‹¡å¤§

---

## é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: åŸºç›¤å¼·åŒ–ï¼ˆçŸ­æœŸï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå¾‹å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ            â”‚
â”‚     - TaskContext å‹å®šç¾©                 â”‚
â”‚     - attempt_completion ãƒ‘ã‚¿ãƒ¼ãƒ³        â”‚
â”‚     - ã‚¨ãƒ©ãƒ¼è‡ªå‹•è£œæ­£                      â”‚
â”‚     - ãƒãƒ«ãƒã‚¿ã‚¹ã‚¯ç®¡ç†                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã‚·ã‚¹ãƒ†ãƒ                   â”‚
â”‚     - Resource å‹å®šç¾©                    â”‚
â”‚     - context.resources API             â”‚
â”‚     - ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“é€£æºã®ãƒ‡ãƒ¢              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. MCP çµ±åˆ                            â”‚
â”‚     - MCP Client ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©     â”‚
â”‚     - MCPWrapperPlugin / UIOnlyPlugin   â”‚
â”‚     - æ—¢å­˜ MCP ãƒ„ãƒ¼ãƒ«ã¨ã®é€£æºãƒ‡ãƒ¢         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. æ°¸ç¶šåŒ– API                          â”‚
â”‚     - storage API å®šç¾©                  â”‚
â”‚     - MulmoChat ã§ã®å®Ÿè£…                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 2: æ©Ÿèƒ½æ‹¡å……ï¼ˆä¸­æœŸï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. çµ±ä¸€è¨­å®šã‚·ã‚¹ãƒ†ãƒ                     â”‚
â”‚     - ConfigSchema å®šç¾©                â”‚
â”‚     - è¨­å®š UI è‡ªå‹•ç”Ÿæˆ                  â”‚
â”‚     - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­å®šã®çµ±åˆ             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  6. Capabilities å®£è¨€                   â”‚
â”‚  7. Undo/Redo                          â”‚
â”‚  8. ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¿ã‚¹ã‚¯                â”‚
â”‚  9. ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å®Ÿè¡Œ                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Phase 3: ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ï¼ˆé•·æœŸï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  10. ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚·ã‚¹ãƒ†ãƒ               â”‚
â”‚  11. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãƒãƒ¼ã‚±ãƒƒãƒˆãƒ—ãƒ¬ã‚¤ã‚¹         â”‚
â”‚  12. ä»–ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªã¸ã®å±•é–‹              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¨­è¨ˆåŸå‰‡

### 1. å±¤ã®ç‹¬ç«‹æ€§

å„å±¤ã¯ç‹¬ç«‹ã—ã¦ãƒ†ã‚¹ãƒˆãƒ»é–‹ç™ºã§ãã‚‹ã€‚

```
gui-chat-protocol    â†’ å‹å®šç¾©ã®ã¿ã€å®Ÿè£…ãªã—
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆcoreï¼‰    â†’ OS å±¤ã«ã®ã¿ä¾å­˜
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ï¼ˆvueï¼‰     â†’ core + Vue ã«ä¾å­˜
ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒª          â†’ å…¨å±¤ã‚’çµ±åˆ
```

### 2. æœ€å° API åŸå‰‡

OS å±¤ã® API ã¯æœ€å°é™ã«ä¿ã¤ã€‚

```typescript
// Good: æ±ç”¨çš„ã§æœ€å°é™
context.resources.getById(uuid)

// Bad: ç‰¹å®šãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ç‰¹åŒ–
context.getLastGeneratedImage()
```

### 3. å®£è¨€çš„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€Œä½•ãŒã§ãã‚‹ã‹ã€ã‚’å®£è¨€ã—ã€ã€Œã©ã†å®Ÿç¾ã™ã‚‹ã‹ã€ã¯ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªã«å§”ã­ã‚‹ã€‚

```typescript
// ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å´
capabilities: {
  outputType: "image",
  inputTypes: ["image", "text"],
}

// ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå´ãŒé©åˆ‡ãª UI/ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’æä¾›
```

### 4. å¾Œæ–¹äº’æ›æ€§

æ–°æ©Ÿèƒ½ã¯ Optional ã¨ã—ã¦è¿½åŠ ã—ã€æ—¢å­˜ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å£Šã•ãªã„ã€‚

```typescript
interface ToolContext {
  currentResult?: ToolResult;    // æ—¢å­˜
  app?: ToolContextApp;          // æ—¢å­˜
  resources?: ResourceManager;   // æ–°è¦ï¼ˆOptionalï¼‰
}
```

### 5. ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯éä¾å­˜

OS å±¤ï¼ˆgui-chat-protocolï¼‰ã¯ UI ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ä¾å­˜ã—ãªã„ã€‚

```
gui-chat-protocol/
â”œâ”€â”€ index.ts    # Coreï¼ˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯éä¾å­˜ï¼‰
â”œâ”€â”€ vue.ts      # Vue ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
â””â”€â”€ react.ts    # React ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°
```

---

## ãƒãƒ¼ã‚¿ãƒ“ãƒªãƒ†ã‚£

### ç›®æ¨™

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã® core éƒ¨åˆ†ã¯ã€MulmoChat ä»¥å¤–ã®ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªã§ã‚‚å‹•ä½œã™ã‚‹ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MulmoChat     â”‚  â”‚   Future App A  â”‚  â”‚   Future App B  â”‚
â”‚   (Vue)         â”‚  â”‚   (React)       â”‚  â”‚   (CLI)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ gui-chat-protocol (å…±é€š)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ Coreï¼ˆå…±é€šï¼‰                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å®Ÿç¾ã®ãŸã‚ã«å¿…è¦ãªã“ã¨

1. **gui-chat-protocol ã®æ¨™æº–åŒ–**
   - API ã®å®‰å®šåŒ–
   - ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ãƒãƒªã‚·ãƒ¼
   - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

2. **ãƒ›ã‚¹ãƒˆã‚¢ãƒ—ãƒªå®Ÿè£…ã‚¬ã‚¤ãƒ‰**
   - context.app ã®å®Ÿè£…è¦ä»¶
   - UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®è¦ä»¶
   - ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆ

3. **ãƒ—ãƒ©ã‚°ã‚¤ãƒ³èªè¨¼**
   - äº’æ›æ€§ãƒ†ã‚¹ãƒˆ
   - èªè¨¼ãƒãƒƒã‚¸

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå¾‹å®Ÿè¡Œã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆè©³ç´°åŒ–**
   - TaskContext / TaskManager API è¨­è¨ˆ
   - attempt_completion ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Ÿè£…
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

2. **ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ã®è¨­è¨ˆè©³ç´°åŒ–**
   - Resource å‹å®šç¾©
   - context.resources API
   - æ—¢å­˜ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®å¯¾å¿œ

3. **MCP çµ±åˆã®è¨­è¨ˆè©³ç´°åŒ–**
   - context.app.mcp API è¨­è¨ˆ
   - MCPWrapperPlugin / UIOnlyPlugin å‹å®šç¾©
   - MCP ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šç®¡ç†

4. **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—å®Ÿè£…**
   - ãƒãƒ«ãƒã‚¹ãƒ†ãƒƒãƒ—ã‚¿ã‚¹ã‚¯ã®è‡ªå‹•å®Ÿè¡Œãƒ‡ãƒ¢
   - ç”»åƒç”Ÿæˆ â†’ ç”»åƒç·¨é›†ã®é€£æº
   - æ—¢å­˜ MCP ãƒ„ãƒ¼ãƒ« + UI ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ãƒ‡ãƒ¢
   - ã‚¨ãƒ©ãƒ¼è‡ªå‹•è£œæ­£ã®ãƒ‡ãƒ¢

5. **é–‹ç™ºè€…ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯**
   - API è¨­è¨ˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
   - ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®åé›†

---

## GUI Chat Protocol ã¨ã®å¯¾å¿œ

ã“ã®ãƒ“ã‚¸ãƒ§ãƒ³ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ [GUI Chat Protocol](../GUI_CHAT_PROTOCOL.md) ã®ç™ºå±•å½¢ã§ã™ã€‚

### ç”¨èªã®å¯¾å¿œ

| GUI Chat Protocol | ç¾åœ¨ã®å®Ÿè£… | èª¬æ˜ |
|-------------------|-----------|------|
| `llmResponse` | `result.message` | LLM ã«è¿”ã™ãƒ†ã‚­ã‚¹ãƒˆ |
| `guiData` | `result.data` | UI è¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ |
| `guiData.type` | `toolName` | ã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§è¡¨ç¤ºã™ã‚‹ã‹ |
| `instructions` | `result.instructions` | LLM ã¸ã®è¿½åŠ æŒ‡ç¤º |
| Role | systemPrompt + enabledPlugins | ãƒ„ãƒ¼ãƒ«é¸æŠ + ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ |
| Tool | Plugin | LLM ãŒå‘¼ã³å‡ºã›ã‚‹æ©Ÿèƒ½ |

### GUI Chat Protocol ã®ã‚³ã‚¢æ¦‚å¿µ

**Enhanced Tool Callsï¼ˆæ‹¡å¼µãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ï¼‰:**
```
ãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ â†’ LLM ã¸ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ + GUI ç”¨ãƒ‡ãƒ¼ã‚¿
         â†’ LLM ã¯ä¼šè©±ã‚’ç¶™ç¶š
         â†’ UI ã¯é©åˆ‡ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤º
```

**Rolesï¼ˆãƒ­ãƒ¼ãƒ«ï¼‰:**
```typescript
// Role = åˆ©ç”¨å¯èƒ½ãªãƒ„ãƒ¼ãƒ« + ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
interface Role {
  name: string;
  tools: string[];      // æœ‰åŠ¹ãªãƒ—ãƒ©ã‚°ã‚¤ãƒ³
  systemPrompt: string; // æŒ¯ã‚‹èˆã„ã®æŒ‡ç¤º
}

// ä¾‹: Recipe Guide ãƒ­ãƒ¼ãƒ«
const recipeGuide: Role = {
  name: "recipeGuide",
  tools: ["presentForm", "presentDocument", "generateImage", "browse"],
  systemPrompt: "ã‚ãªãŸã¯æ–™ç†ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’..."
};
```

**å‹•çš„ãƒ­ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ:**
```typescript
// LLM ãŒ switchRole ã‚’å‘¼ã³å‡ºã—ã¦ãƒ­ãƒ¼ãƒ«ã‚’å¤‰æ›´
switchRole({ role: "recipeGuide" });  // æ–™ç†ã‚¬ã‚¤ãƒ‰ãƒ¢ãƒ¼ãƒ‰
switchRole({ role: "tutor" });        // å®¶åº­æ•™å¸«ãƒ¢ãƒ¼ãƒ‰
switchRole({ role: "tripPlanner" });  // æ—…è¡Œãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ãƒ¢ãƒ¼ãƒ‰
```

### æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§è¿½åŠ ã™ã‚‹æ©Ÿèƒ½

GUI Chat Protocol ã®åŸºç›¤ã®ä¸Šã«ã€ä»¥ä¸‹ã‚’è¿½åŠ :

1. **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆè‡ªå¾‹å®Ÿè¡Œ** - attempt_completion ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹è‡ªå‹•ãƒ«ãƒ¼ãƒ—
2. **ãƒªã‚½ãƒ¼ã‚¹å‚ç…§ã‚·ã‚¹ãƒ†ãƒ ** - ãƒ„ãƒ¼ãƒ«çµæœé–“ã®ãƒ‡ãƒ¼ã‚¿å…±æœ‰
3. **MCP çµ±åˆ** - æ—¢å­˜ MCP ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã®æ´»ç”¨
4. **ã‚¿ã‚¹ã‚¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†** - è¤‡æ•°ã‚¿ã‚¹ã‚¯ã®ä¸¦è¡Œç®¡ç†
5. **ãƒ„ãƒ¼ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜** - RFC çš„ãªæ¨™æº–åŒ–

ã“ã‚Œã‚‰ã¯ GUI Chat Protocol ã®ã€ŒChat-Centric OSã€ãƒ“ã‚¸ãƒ§ãƒ³ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®å…·ä½“çš„ãªå®Ÿè£…æ–¹é‡ã§ã™ã€‚

---

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [GUI Chat Protocol](../GUI_CHAT_PROTOCOL.md) - åŸºç›¤ã¨ãªã‚‹ãƒ—ãƒ­ãƒˆã‚³ãƒ«ä»•æ§˜
- [ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](./plugin-architecture.ja.md)
- [ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–‹ç™ºã‚¬ã‚¤ãƒ‰](./plugin-development-guide.ja.md)
- [ãƒ—ãƒ©ã‚°ã‚¤ãƒ³æŠ½å‡ºã‚¬ã‚¤ãƒ‰](./plugin-extraction-guide.ja.md)
